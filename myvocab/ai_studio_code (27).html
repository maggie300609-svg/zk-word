<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¸­è€ƒ1600è¯ - 54å¤©å…¨èƒ½ç‰¹è®­ç³»ç»Ÿ</title>
    <!-- å¼•ç”¨ Tailwind CSS ç”¨äºç¾åŒ–ç•Œé¢ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&display=swap');
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* å…¼å®¹æ‰€æœ‰æµè§ˆå™¨çš„åŠ¨ç”» */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        .shake { animation: shake 0.4s ease-in-out; }
        
        .day-card { transition: all 0.2s; -webkit-tap-highlight-color: transparent; border: 2px solid #f1f5f9; cursor: pointer; border-radius: 20px; }
        .day-card:active { transform: scale(0.95); background-color: #f8fafc; }
        .day-passed { border-color: #10b981 !important; background-color: #f0fdf4 !important; }
        
        input:focus { outline: none; border-bottom-color: #6366f1 !important; }
        body { padding-bottom: env(safe-area-inset-bottom); background-color: #f8fafc; }
    </style>
</head>
<body>

    <!-- ç¬¬ä¸€å±‚ï¼šSafari è¯­éŸ³æƒé™è§£é” (å¿…é¡»ç‚¹å‡»ä¸€ä¸‹ç½‘é¡µæ‰èƒ½å‘éŸ³) -->
    <div id="unlock-screen" class="fixed inset-0 bg-indigo-600 z-[1000] flex flex-col items-center justify-center text-white p-8">
        <div class="text-6xl mb-6">ğŸ“–</div>
        <h1 class="text-4xl font-black mb-4 italic tracking-tighter">VOCAB 1600</h1>
        <p class="text-indigo-100 mb-10 text-center text-lg">æ¬¢è¿å¼€å¯ 54 å¤©é€šå…³ç‰¹è®­<br><span class="text-sm opacity-70">(ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥æ¿€æ´»ç³»ç»Ÿè¯­éŸ³)</span></p>
        <button onclick="activateSystem()" class="bg-white text-indigo-600 px-16 py-4 rounded-2xl font-black text-xl shadow-2xl active:scale-90 transition-transform">
            å¼€å¯å­¦ä¹ 
        </button>
    </div>

    <!-- ç¬¬äºŒå±‚ï¼šä¸»ç¨‹åºç•Œé¢ -->
    <div id="app" class="max-w-5xl mx-auto p-4 md:p-8 hidden">
        
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 bg-white p-6 rounded-[2rem] shadow-sm gap-4 border border-white">
            <div class="text-center md:text-left">
                <h1 class="text-3xl font-black text-indigo-600 italic">VOCAB 1600</h1>
                <p id="total-progress" class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1 font-mono">Loading...</p>
            </div>
            <div class="flex flex-wrap justify-center gap-2">
                <button onclick="showMistakes()" class="text-xs bg-red-50 text-red-500 px-4 py-2 rounded-full font-bold">é”™é¢˜æœ¬ (<span id="m-count">0</span>)</button>
                <button onclick="openImport()" class="text-xs bg-indigo-50 text-indigo-600 px-4 py-2 rounded-full font-bold">å¯¼å…¥è¯åº“</button>
                <button onclick="resetData()" class="text-xs bg-slate-100 text-slate-400 px-4 py-2 rounded-full font-bold">é‡ç½®</button>
            </div>
        </div>

        <!-- è§†å›¾ 1ï¼šDay æ¸…å• -->
        <div id="view-index" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>

        <!-- è§†å›¾ 2ï¼šè®­ç»ƒ Session -->
        <div id="view-session" class="hidden max-w-2xl mx-auto">
            <div class="flex justify-between items-center mb-4">
                <button onclick="location.reload()" class="font-bold text-slate-400 p-2">â† é€€å‡º</button>
                <div id="phase-badge" class="px-4 py-1 bg-indigo-100 text-indigo-600 rounded-full text-[10px] font-black uppercase">PHASE 1</div>
            </div>
            <div class="w-full bg-slate-200 h-1.5 rounded-full overflow-hidden mb-6"><div id="bar" class="bg-indigo-500 h-full transition-all duration-500 w-0"></div></div>
            
            <div class="bg-white rounded-[3rem] shadow-xl p-6 md:p-12 min-h-[500px] flex flex-col items-center justify-center relative border border-white">
                <div id="counter" class="absolute top-8 left-10 text-[10px] font-mono text-slate-300 font-black">01 / 30</div>
                
                <!-- ç¯èŠ‚ 1ï¼šè®¤è¯» -->
                <div id="recall-ui" class="w-full text-center">
                    <h2 id="recall-w" class="text-5xl md:text-7xl font-black text-slate-800 mb-2 tracking-tighter uppercase font-mono" onclick="playVoice()">WORD</h2>
                    <button onclick="playVoice()" class="mb-10 text-indigo-400 font-bold text-sm">ğŸ”Š æ…¢é€Ÿæœ—è¯»</button>
                    <div id="recall-cn-box" class="hidden mb-12 p-8 bg-slate-50 rounded-3xl border border-slate-100"><p id="recall-cn" class="text-2xl font-bold text-indigo-900 leading-tight"></p></div>
                    <div id="recall-btns" class="grid grid-cols-2 gap-4">
                        <button onclick="handleRecall(false)" class="py-5 bg-slate-100 text-slate-400 font-bold rounded-2xl">ä¸è®¤è¯†</button>
                        <button onclick="handleRecall(true)" class="py-5 bg-indigo-600 text-white font-bold rounded-2xl text-lg shadow-lg">è®¤è¯†</button>
                    </div>
                    <button id="recall-next" onclick="stepNext()" class="hidden w-full py-5 bg-slate-800 text-white font-bold rounded-2xl text-lg">ä¸‹ä¸€ä¸ªè¯ (Enter)</button>
                </div>

                <!-- ç¯èŠ‚ 2ï¼šæ‹¼å†™ -->
                <div id="spell-ui" class="hidden w-full text-center">
                    <p id="spell-cn" class="text-2xl font-bold text-slate-700 mb-8"></p>
                    <div id="hint-box" class="mb-8 p-6 bg-slate-50 rounded-3xl min-h-[120px] flex flex-col justify-center border border-slate-100">
                        <div id="hint-txt" class="text-4xl md:text-6xl font-mono font-bold tracking-[0.2em] text-slate-200 uppercase">_ _ _ _</div>
                    </div>
                    <input type="text" id="spell-in" class="w-full border-b-4 border-slate-200 text-3xl md:text-4xl text-center py-4 bg-transparent text-indigo-600 font-mono font-bold" placeholder="è¯·æ‹¼å†™..." autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" enterkeyhint="done">
                </div>
            </div>
        </div>

        <!-- è§†å›¾ 3ï¼šé”™é¢˜åº“ -->
        <div id="view-mistakes" class="hidden">
            <div class="flex justify-between items-center mb-6 px-2">
                <h2 class="text-2xl font-black italic">My Mistakes</h2>
                <div class="flex gap-2">
                    <button onclick="startMistakeSession()" class="px-6 py-2 bg-red-500 text-white rounded-xl font-bold shadow-lg">æ¶ˆç­é”™é¢˜ (30)</button>
                    <button onclick="location.reload()" class="px-6 py-2 bg-slate-800 text-white rounded-xl font-bold">è¿”å›</button>
                </div>
            </div>
            <div id="mistake-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
        </div>

        <!-- å¯¼å…¥å¼¹çª— -->
        <div id="import-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[2000] flex items-center justify-center p-4">
            <div class="bg-white rounded-[2.5rem] p-8 max-w-2xl w-full shadow-2xl">
                <h2 class="text-2xl font-black mb-4 tracking-tight">å¯¼å…¥ 1600 è¯åº“</h2>
                <p class="text-sm text-slate-400 mb-4">è¯·å°† PDF ä¸­çš„å…¨æ–‡å­—ç²˜è´´åœ¨ä¸‹æ–¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«è¯æ€§å’Œç¿»è¯‘ï¼š</p>
                <textarea id="import-txt" class="w-full h-80 p-5 bg-slate-50 border rounded-3xl font-mono text-sm shadow-inner mb-6 outline-none focus:border-indigo-500" placeholder="ability n. èƒ½åŠ›...&#10;able a. èƒ½å¤Ÿ..."></textarea>
                <div class="flex justify-center gap-3">
                    <button onclick="closeImport()" class="px-8 py-2 text-slate-400 font-bold">å–æ¶ˆ</button>
                    <button onclick="processImport()" class="px-10 py-2 bg-indigo-600 text-white rounded-2xl font-bold shadow-xl shadow-indigo-100">è§£æå¹¶å¼€å§‹</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const STORAGE = { DB: "zk_1600_db", PROGRESS: "zk_1600_prog", MISTAKES: "zk_1600_mistakes" };
        let vocab = [], sessionWords = [], mistakesInDay = [];
        let globalMistakes = JSON.parse(localStorage.getItem(STORAGE.MISTAKES)) || [];
        let userProgress = JSON.parse(localStorage.getItem(STORAGE.PROGRESS)) || {};
        let cursor = 0, phase = 1, hintLevel = 0, currentDay = -1;

        // Safari è¯­éŸ³æ¿€æ´»å‡½æ•°
        function activateSystem() {
            const silentMsg = new SpeechSynthesisUtterance("Start");
            silentMsg.volume = 0;
            window.speechSynthesis.speak(silentMsg);
            
            document.getElementById('unlock-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            loadApp();
        }

        function loadApp() {
            const saved = localStorage.getItem(STORAGE.DB);
            if (saved) {
                vocab = JSON.parse(saved);
                renderIndex();
                updateStats();
            } else {
                openImport();
            }
        }

        function processImport() {
            const raw = document.getElementById('import-txt').value;
            const res = [];
            raw.split('\n').forEach(line => {
                // æ­£åˆ™è§£æï¼šæå–å•è¯éƒ¨åˆ†å’Œç¿»è¯‘éƒ¨åˆ†
                const match = line.trim().match(/^([a-zA-Z\s\(\)\-\.]+)\s+(.*)$/);
                if (match) res.push({ w: match[1].trim(), d: match[2].trim() });
            });
            if (res.length > 0) {
                localStorage.setItem(STORAGE.DB, JSON.stringify(res));
                location.reload();
            }
        }

        function renderIndex() {
            const container = document.getElementById('view-index');
            container.innerHTML = "";
            const totalDays = Math.ceil(vocab.length / 30);
            for (let i = 0; i < totalDays; i++) {
                const group = vocab.slice(i * 30, (i + 1) * 30);
                const first = group[0].w[0].toUpperCase();
                const last = group[group.length - 1].w[0].toUpperCase();
                const div = document.createElement('div');
                div.className = `day-card bg-white p-5 shadow-sm border-2 ${userProgress[i] ? 'day-passed' : ''}`;
                div.onclick = () => startSession(i);
                div.innerHTML = `<div class="text-[10px] font-black text-slate-300 mb-1 font-mono uppercase tracking-tighter">DAY ${i+1}</div><div class="text-2xl font-black">${first === last ? first : first+' - '+last}</div>`;
                container.appendChild(div);
            }
        }

        function startSession(dayIdx) {
            currentDay = dayIdx;
            sessionWords = vocab.slice(dayIdx * 30, (dayIdx + 1) * 30);
            cursor = 0; phase = 1; mistakesInDay = [];
            updateView('view-session');
            showRecall();
        }

        function showRecall() {
            const word = sessionWords[cursor];
            document.getElementById('phase-badge').innerText = `PHASE 1: è®¤è¯» (D${currentDay+1})`;
            toggleDisplay('recall-ui', 'spell-ui');
            document.getElementById('recall-cn-box').classList.add('hidden');
            toggleDisplay('recall-btns', 'recall-next');
            document.getElementById('recall-w').innerText = word.w;
            document.getElementById('recall-cn').innerText = word.d;
            updateSessionStats();
        }

        function handleRecall(known) {
            document.getElementById('recall-cn-box').classList.remove('hidden');
            toggleDisplay('recall-next', 'recall-btns');
            playVoice(); // è®¤è¯»ç‚¹å‡»åè‡ªåŠ¨æœ—è¯»
            if (!known) {
                recordMistake(sessionWords[cursor]);
                if (!mistakesInDay.find(m => m.w === sessionWords[cursor].w)) mistakesInDay.push(sessionWords[cursor]);
            }
        }

        function stepNext() {
            cursor++;
            if (cursor < sessionWords.length) showRecall();
            else startSpellPhase();
        }

        function startSpellPhase() {
            phase = 2; cursor = 0;
            sessionWords = [...sessionWords].sort(() => Math.random() - 0.5);
            document.getElementById('phase-badge').innerText = "PHASE 2: ç›²æ‰“æ‹¼å†™";
            toggleDisplay('spell-ui', 'recall-ui');
            showSpell();
        }

        function showSpell() {
            const list = (phase === 3) ? mistakesInDay : sessionWords;
            document.getElementById('spell-cn').innerText = list[cursor].d;
            document.getElementById('spell-in').value = "";
            hintLevel = 0;
            updateHintUI(list[cursor].w);
            updateSessionStats();
            setTimeout(() => document.getElementById('spell-in').focus(), 200);
        }

        function checkSpell() {
            const list = (phase === 3) ? mistakesInDay : sessionWords;
            const word = list[cursor];
            const input = document.getElementById('spell-in').value.trim().toLowerCase();
            if (input === word.w.toLowerCase()) {
                cursor++;
                if (cursor < list.length) showSpell();
                else if (phase === 2 && mistakesInDay.length > 0) startRecovery();
                else finishDay();
            } else {
                recordMistake(word);
                if (!mistakesInDay.find(m => m.w === word.w)) mistakesInDay.push(word);
                document.getElementById('spell-in').classList.add('shake');
                hintLevel++;
                updateHintUI(word.w);
                setTimeout(() => document.getElementById('spell-in').classList.remove('shake'), 400);
            }
        }

        function startRecovery() {
            phase = 3; cursor = 0; alert("è¿›å…¥é”™é¢˜å¼ºåŒ–ï¼Œç›´åˆ°å…¨éƒ¨æ‹¼å¯¹ï¼");
            mistakesInDay = [...mistakesInDay].sort(() => Math.random() - 0.5);
            showSpell();
        }

        function playVoice() {
            const list = (phase === 1) ? sessionWords : (phase === 3 ? mistakesInDay : sessionWords);
            // æ¸…ç†è¯æ€§ï¼Œåªè¯»å•è¯
            let w = list[cursor].w.replace(/\(.*\)/g, "").split(/\s(n|v|a|ad|prep|pron|conj|num|art|int|vi|vt)\./)[0].trim();
            const msg = new SpeechSynthesisUtterance(w);
            msg.lang = 'en-US'; msg.rate = 0.6; // æ…¢é€Ÿ
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(msg);
        }

        function updateHintUI(w) {
            const txt = w.split('').map((l, i) => i < hintLevel ? l : '_').join(' ');
            document.getElementById('hint-txt').innerText = txt;
            document.getElementById('hint-txt').className = `text-4xl md:text-6xl font-mono font-bold tracking-[0.2em] uppercase ${hintLevel > 0 ? 'text-red-500' : 'text-slate-200'}`;
        }

        function recordMistake(word) {
            if (!globalMistakes.find(m => m.w === word.w)) {
                globalMistakes.push(word);
                localStorage.setItem(STORAGE.MISTAKES, JSON.stringify(globalMistakes));
                updateStats();
            }
        }

        function finishDay() {
            if (currentDay !== -1) {
                userProgress[currentDay] = true;
                localStorage.setItem(STORAGE.PROGRESS, JSON.stringify(userProgress));
            }
            alert("æœ¬æ—¥ç‰¹è®­å®Œæˆï¼Œè‚Œè‚‰è®°å¿†+1ï¼");
            location.reload();
        }

        function updateStats() {
            const mastered = Object.keys(userProgress).length * 30;
            document.getElementById('total-progress').innerText = `MASTERED: ${mastered} / ${vocab.length} WORDS`;
            document.getElementById('m-count').innerText = globalMistakes.length;
        }

        function showMistakes() {
            updateView('view-mistakes');
            const container = document.getElementById('mistake-list');
            container.innerHTML = globalMistakes.map(m => `
                <div class="bg-white p-5 rounded-3xl border flex justify-between items-center shadow-sm">
                    <div><div class="font-bold text-indigo-600 text-lg uppercase font-mono">${m.w}</div><div class="text-xs text-slate-400 font-medium">${m.d}</div></div>
                    <button onclick="removeMistake('${m.w}')" class="text-red-400 text-xs font-black uppercase ml-4">ç§»é™¤</button>
                </div>
            `).join('');
        }

        function removeMistake(w) {
            globalMistakes = globalMistakes.filter(m => m.w !== w);
            localStorage.setItem(STORAGE.MISTAKES, JSON.stringify(globalMistakes));
            showMistakes(); updateStats();
        }

        function startMistakeSession() {
            if (globalMistakes.length === 0) return;
            sessionWords = [...globalMistakes].sort(() => Math.random() - 0.5).slice(0, 30);
            cursor = 0; phase = 2; mistakesInDay = []; currentDay = -1;
            updateView('view-session'); showSpell();
        }

        function updateSessionStats() {
            const list = (phase === 3) ? mistakesInDay : sessionWords;
            document.getElementById('bar').style.width = `${(cursor / list.length) * 100}%`;
            document.getElementById('counter').innerText = `${cursor+1} / ${list.length}`;
        }

        function updateView(id) {
            ['view-index', 'view-session', 'view-mistakes'].forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function toggleDisplay(s, h) {
            document.getElementById(s).classList.remove('hidden');
            document.getElementById(h).classList.add('hidden');
        }

        function openImport() { document.getElementById('import-modal').classList.remove('hidden'); }
        function closeImport() { document.getElementById('import-modal').classList.add('hidden'); }
        function resetData() { if(confirm("ç¡®å®šæ¸…ç©ºè¿›åº¦ï¼Ÿ")) { localStorage.removeItem(STORAGE.PROGRESS); location.reload(); } }

        // é”®ç›˜ Enter æäº¤é€»è¾‘
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (phase === 1 && !document.getElementById('recall-next').classList.contains('hidden')) stepNext();
                else if (phase >= 2) checkSpell();
            }
        });
    </script>
</body>
</html>